Script started on Thu Jul 28 16:53:53 2016
wolf:~/Lab10% gdv[Kb bufserver
GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2.1) 7.4-2012.04
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
For bug reporting instructions, please see:
<http://bugs.launchpad.net/gdb-linaro/>...
Reading symbols from /h/u13/g6/00/g5tqian/Lab10/bufserver...done.
(gdb) break main
Breakpoint 1 at 0x400a4c: file bufserver.c, line 65.
(gdb) reun   un
Starting program: /h/u13/g6/00/g5tqian/Lab10/bufserver 
warning: no loadable sections found in added symbol-file system-supplied DSO at 0x7ffff7ffa000

Breakpoint 1, main () at bufserver.c:65
65      int main() {
(gdb) n
77        listenfd = setup();
(gdb) n
Listening on 51352
79          socklen = sizeof(peer);
(gdb) n
83          if ((fd = accept(listenfd, (struct sockaddr *)&peer, &socklen)) < 0) {
(gdb) n
n
n
n
n
n
n
87            printf("New connection on port %d\n", ntohs(peer.sin_port));
(gdb) n
New connection on port 53928
90            inbuf = 0;          // buffer is empty; has no bytes
(gdb) n
91            room = sizeof(buf); // room == capacity of the whole buffer
(gdb) n
92            after = buf;        // start writing at beginning of buf
(gdb) n
94            while ((nbytes = read(fd, after, room)) > 0) {
(gdb) n
n
n
n
n
n
n
n
96              inbuf += nbytes;
(gdb) n
99              where = find_network_newline(buf, inbuf);
(gdb) n
101             if (where >= 0) { // OK. we have a full line
(gdb) n
127             after = buf + inbuf;
(gdb) n
128             room = sizeof(buf) - inbuf;
(gdb) n
94            while ((nbytes = read(fd, after, room)) > 0) {
(gdb) n
n
96              inbuf += nbytes;
(gdb) n
99              where = find_network_newline(buf, inbuf);
(gdb) n
101             if (where >= 0) { // OK. we have a full line
(gdb) n
127             after = buf + inbuf;
(gdb) n
128             room = sizeof(buf) - inbuf;
(gdb) n
94            while ((nbytes = read(fd, after, room)) > 0) {
(gdb) n
96              inbuf += nbytes;
(gdb) n
99              where = find_network_newline(buf, inbuf);
(gdb) n
101             if (where >= 0) { // OK. we have a full line
(gdb) n
109               buf[where] = '\n';
(gdb) n
111               printf("Next message: %s", buf);
(gdb) n
Next message: A stitch in time

118               inbuf -= where;
(gdb) n
122               memmove(buf, buf + where, inbuf);
(gdb) n
127             after = buf + inbuf;
(gdb) n
128             room = sizeof(buf) - inbuf;
(gdb) n
94            while ((nbytes = read(fd, after, room)) > 0) {
(gdb) n
96              inbuf += nbytes;
(gdb) quit
A debugging session is active.

        Inferior 1 [process 17397] will be killed.

Quit anyway? (y or n) y
wolf:~/Lab10% exit
exit

Script done on Thu Jul 28 17:00:48 2016
